{% extends "base.html" %}

{% block title %}ä»ªè¡¨æ¿ - å¿«æ‰‹è´¦å·ç®¡ç†å¹³å°{% endblock %}

{% block page_title %}ä»ªè¡¨æ¿{% endblock %}

{% block content %}
<!-- æ–°æ‰‹å¼•å¯¼å¡ç‰‡ -->
<div class="guide-card">
    <div class="guide-header">
        <div class="guide-icon">ğŸ“–</div>
        <div class="guide-title">
            <h3>æ–°æ‰‹å…¥é—¨æŒ‡å—</h3>
            <p>å¿«é€Ÿå¼€å§‹ä½¿ç”¨å¿«æ‰‹è´¦å·ç®¡ç†å¹³å°</p>
        </div>
    </div>
    <div class="guide-body">
        <div class="guide-item">
            <span class="guide-item-icon">ğŸ“±</span>
            <div class="guide-item-content">
                <h4>ä¸‹è½½å¿«æ‰‹æé€Ÿç‰ˆ</h4>
                <p>è¯·ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„å¿«æ‰‹æé€Ÿç‰ˆ APPï¼Œç¡®ä¿è„šæœ¬æ­£å¸¸è¿è¡Œ</p>
                <a href="/data/software/å¿«æ‰‹æé€Ÿç‰ˆæck.apk"
                   class="btn btn-primary btn-sm"
                   download>
                    <span>ğŸ“¥</span> ä¸‹è½½ APK å®‰è£…åŒ…
                </a>
            </div>
        </div>
        <div class="guide-item">
            <span class="guide-item-icon">ğŸ“„</span>
            <div class="guide-item-content">
                <h4>æŸ¥çœ‹æ­å»ºè¯´æ˜</h4>
                <p>è¯¦ç»†çš„æ–°æ‰‹æ­å»ºæ•™ç¨‹ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹</p>
                <button class="btn btn-secondary btn-sm" onclick="showGuideDocument()">
                    <span>ğŸ‘ï¸</span> æŸ¥çœ‹è¯´æ˜æ–‡æ¡£
                </button>
            </div>
        </div>
        <div class="guide-item">
            <span class="guide-item-icon">ğŸ‘¥</span>
            <div class="guide-item-content">
                <h4>è¿›ç¾¤äºŒç»´ç </h4>
                <p>æ‰«ç åŠ å…¥äº¤æµç¾¤ï¼Œè·å–æœ€æ–°é€šçŸ¥ä¸ç­”ç–‘</p>
                <a class="guide-qr-link" href="/data/describe/images/è¿›ç¾¤.jpg" target="_blank" title="ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹">
                    <img class="guide-qr-img" src="/data/describe/images/è¿›ç¾¤.jpg" alt="è¿›ç¾¤äºŒç»´ç ">
                </a>
            </div>
        </div>
    </div>
</div>

<!-- è´¦å·çŠ¶æ€æé†’ï¼ˆä»Šæ—¥/æ˜¨æ—¥è‡ªåŠ¨åˆ‡æ¢ï¼‰ -->
<div class="dashboard-card account-health-card">
    <div class="card-header">
        <div>
            <h3 id="accountHealthTitle">è´¦å·çŠ¶æ€æé†’</h3>
            <div class="account-health-meta" id="accountHealthMeta">åŠ è½½ä¸­...</div>
        </div>
        <a href="/config-envs" class="view-all-link">å»é…ç½®ç¯å¢ƒ â†’</a>
    </div>
    <div class="card-body">
        <div class="account-health-summary" id="accountHealthSummary"></div>
        <div class="table-responsive">
            <table class="data-table health-table">
                <thead>
                    <tr>
                        <th>è´¦å·å¤‡æ³¨</th>
                        <th>å½’å±å…³ç³»</th>
                        <th id="accountHealthCoinsTh" style="text-align:right;">ç»Ÿè®¡é‡‘å¸</th>
                        <th>çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="accountHealthBody">
                    <tr><td colspan="5" class="loading-cell">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        <div class="account-health-hint" id="accountHealthHint">
            åˆ¤å®šå£å¾„ï¼šéœ€æ›´æ¢é…ç½®=ç»Ÿè®¡æ—¥ 0ï¼›é»‘å·=0&lt;ç»Ÿè®¡æ—¥&lt;500ï¼›è¾¹ç¼˜=500â‰¤ç»Ÿè®¡æ—¥&lt;10000ã€‚
        </div>
    </div>
</div>

<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-icon">âš™ï¸</div>
        <div class="stat-content">
            <span class="stat-value" id="statConfigs">0</span>
            <span class="stat-label">è„šæœ¬é…ç½®</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-content">
            <span class="stat-value" id="statYesterdayCoins">0</span>
            <span class="stat-label">æ˜¨æ—¥é‡‘å¸</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">ğŸ‘›</div>
        <div class="stat-content">
            <span class="stat-value" id="statWalletBalance">Â¥0.00</span>
            <span class="stat-label">é’±åŒ…ä½™é¢</span>
        </div>
    </div>
</div>

<div class="dashboard-grid">
    <!-- æˆ‘çš„æ¨å¹¿ç  -->
    <div class="dashboard-card referral-card">
        <div class="card-header">
            <h3>ğŸ æˆ‘çš„æ¨å¹¿ç </h3>
            <a href="/referral" class="view-all-link">æ¨å¹¿ä¸­å¿ƒ â†’</a>
        </div>
        <div class="card-body">
            <div class="referral-code-box">
                <span class="referral-code" id="dashboardReferralCode">åŠ è½½ä¸­...</span>
                <button class="btn btn-secondary btn-sm" onclick="copyDashboardCode()">å¤åˆ¶</button>
            </div>
            <div class="referral-stats">
                <span>ç›´æ¥é‚€è¯·: <strong id="dashboardLevel1">0</strong> äºº</span>
                <span>é—´æ¥é‚€è¯·: <strong id="dashboardLevel2">0</strong> äºº</span>
            </div>
        </div>
    </div>
    
    <!-- å¿«é€Ÿæ“ä½œ -->
    <!-- æ”¶ç›Šè¶‹åŠ¿ -->
    <div class="dashboard-card full-width">
        <div class="card-header">
            <h3>è¿‘7å¤©æ”¶ç›Šè¶‹åŠ¿</h3>
        </div>
        <div class="card-body">
            <div class="earnings-chart" id="earningsChart">
                <div class="chart-bars" id="chartBars">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="chart-labels" id="chartLabels">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- æœ€è¿‘æ´»åŠ¨ -->
    <div class="dashboard-card">
        <div class="card-header">
            <h3>æœ€è¿‘æ´»åŠ¨</h3>
        </div>
        <div class="card-body">
            <div class="activity-list" id="activityList">
                <div class="loading-placeholder">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
    
    <!-- å¾…å¤„ç†äº‹é¡¹ -->
    <div class="dashboard-card">
        <div class="card-header">
            <h3>å¾…å¤„ç†äº‹é¡¹</h3>
        </div>
        <div class="card-body">
            <div class="todo-list" id="todoList">
                <div class="todo-item warning">
                    <span class="todo-icon">âš ï¸</span>
                    <span class="todo-text">æš‚æ— å¾…å¤„ç†äº‹é¡¹</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* æ–°æ‰‹å¼•å¯¼å¡ç‰‡æ ·å¼ */
.guide-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}
.guide-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
}
.guide-icon {
    font-size: 40px;
    background: rgba(255,255,255,0.2);
    width: 64px;
    height: 64px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.guide-title h3 {
    margin: 0 0 4px 0;
    font-size: 20px;
    font-weight: 600;
}
.guide-title p {
    margin: 0;
    opacity: 0.9;
    font-size: 14px;
}
.guide-body {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 16px;
}
.guide-qr-link {
    display: inline-block;
    margin-top: 4px;
}
.guide-qr-img {
    width: 110px;
    height: 110px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.35);
    background: rgba(255, 255, 255, 0.08);
}
@media (max-width: 1100px) {
    .guide-body {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
}
@media (max-width: 768px) {
    .guide-body {
        grid-template-columns: 1fr;
    }
}
.guide-item {
    background: rgba(255,255,255,0.15);
    border-radius: 10px;
    padding: 16px;
    display: flex;
    gap: 12px;
    backdrop-filter: blur(10px);
}
.guide-item-icon {
    font-size: 28px;
    flex-shrink: 0;
}
.guide-item-content h4 {
    margin: 0 0 6px 0;
    font-size: 16px;
    font-weight: 600;
}
.guide-item-content p {
    margin: 0 0 12px 0;
    font-size: 13px;
    opacity: 0.9;
    line-height: 1.5;
}
.guide-item .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
}
.guide-item .btn-primary {
    background: white;
    color: #667eea;
    border: none;
}
.guide-item .btn-primary:hover {
    background: #f0f0f0;
}
.guide-item .btn-secondary {
    background: rgba(255,255,255,0.2);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
}
.guide-item .btn-secondary:hover {
    background: rgba(255,255,255,0.3);
}

/* æ–‡æ¡£æ¨¡æ€æ¡†æ ·å¼ */
.guide-modal-content {
    max-height: 70vh;
    overflow-y: auto;
    padding: 20px;
    line-height: 1.8;
}
.guide-modal-content h1, .guide-modal-content h2, .guide-modal-content h3 {
    color: var(--primary-color);
    margin-top: 20px;
    margin-bottom: 10px;
}
.guide-modal-content h1 { font-size: 24px; }
.guide-modal-content h2 { font-size: 20px; }
.guide-modal-content h3 { font-size: 18px; }
.guide-modal-content p {
    margin-bottom: 12px;
    color: var(--text-color);
}
.guide-modal-content .doc-table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
}
.guide-modal-content .doc-table td {
    border: 1px solid var(--border-color);
    padding: 10px;
}
.guide-modal-content .loading-text {
    text-align: center;
    padding: 40px;
    color: var(--text-muted);
}

/* æ¨å¹¿ç å¡ç‰‡æ ·å¼ */
.referral-card .referral-code-box {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}
.referral-card .referral-code {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary-color);
    letter-spacing: 2px;
    background: var(--bg-color);
    padding: 8px 16px;
    border-radius: 6px;
}
.referral-card .referral-stats {
    display: flex;
    gap: 20px;
    font-size: 13px;
    color: var(--text-muted);
}
.referral-card .referral-stats strong {
    color: var(--primary-color);
}

/* è´¦å·çŠ¶æ€æé†’ */
.account-health-meta {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
}
.account-health-summary {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 14px;
}
.health-pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    font-size: 13px;
    background: var(--bg-color);
    border: 1px solid var(--border-color);
}
.health-pill strong {
    font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
}
.health-pill.need {
    background: rgba(239, 68, 68, 0.08);
    border-color: rgba(239, 68, 68, 0.18);
    color: #991b1b;
}
.health-pill.black {
    background: rgba(245, 158, 11, 0.10);
    border-color: rgba(245, 158, 11, 0.22);
    color: #92400e;
}
.health-pill.edge {
    background: rgba(59, 130, 246, 0.08);
    border-color: rgba(59, 130, 246, 0.18);
    color: #1d4ed8;
}
.health-pill.normal {
    background: rgba(16, 185, 129, 0.10);
    border-color: rgba(16, 185, 129, 0.22);
    color: #065f46;
}
.health-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
}
.health-badge.need {
    background: rgba(239, 68, 68, 0.12);
    color: #991b1b;
}
.health-badge.black {
    background: rgba(245, 158, 11, 0.14);
    color: #92400e;
}
.health-badge.edge {
    background: rgba(59, 130, 246, 0.12);
    color: #1d4ed8;
}
.health-badge.normal {
    background: rgba(16, 185, 129, 0.14);
    color: #065f46;
}
.account-health-hint {
    margin-top: 10px;
    font-size: 12px;
    color: var(--text-muted);
}
.health-table td {
    vertical-align: middle;
}
.health-table .coins-cell {
    text-align: right;
    font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    font-size: 12px;
    color: var(--text-color);
}
.health-table .link-action {
    color: var(--primary-color);
    text-decoration: none;
    font-size: 13px;
}
.health-table .link-action:hover {
    text-decoration: underline;
}
.account-health-card .text-ellipsis {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    vertical-align: bottom;
}

/* å“åº”å¼é€‚é… */
@media (max-width: 768px) {
    .guide-card {
        padding: 16px;
    }
    .guide-header {
        flex-direction: column;
        text-align: center;
    }
    .guide-body {
        grid-template-columns: 1fr;
    }
    .guide-item {
        flex-direction: column;
        text-align: center;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardStats();
    loadEarningsChart();
    loadReferralInfo();
    loadAccountHealth();
});

async function loadReferralInfo() {
    try {
        const info = await apiRequest('/me/referral');
        document.getElementById('dashboardReferralCode').textContent = info.my_referral_code;
        document.getElementById('dashboardLevel1').textContent = info.level1_count;
        document.getElementById('dashboardLevel2').textContent = info.level2_count;
    } catch (error) {
        document.getElementById('dashboardReferralCode').textContent = '-';
    }
}

function copyDashboardCode() {
    const code = document.getElementById('dashboardReferralCode').textContent;
    if (code && code !== 'åŠ è½½ä¸­...' && code !== '-') {
        navigator.clipboard.writeText(code).then(() => {
            showToast('æ¨å¹¿ç å·²å¤åˆ¶', 'success');
        }).catch(() => {
            showToast('å¤åˆ¶å¤±è´¥', 'error');
        });
    }
}

async function loadDashboardStats() {
    try {
        const stats = await apiRequest('/stats/dashboard');
        document.getElementById('statConfigs').textContent = stats.total_configs || 0;
        document.getElementById('statYesterdayCoins').textContent = formatNumber(stats.yesterday_coins || 0);
        document.getElementById('statWalletBalance').textContent = 'Â¥' + (stats.wallet_balance || 0).toFixed(2);
    } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
    }
}

async function loadEarningsChart() {
    const barsContainer = document.getElementById('chartBars');
    const labelsContainer = document.getElementById('chartLabels');
    
    try {
        const data = await apiRequest('/stats/earnings-weekly');
        if (data && data.length > 0) {
            const maxValue = Math.max(...data.map(d => d.coins_total));
            barsContainer.innerHTML = data.map(d => {
                const height = maxValue > 0 ? (d.coins_total / maxValue * 100) : 0;
                return `<div class="chart-bar" style="height: ${height}%" title="${formatNumber(d.coins_total)} é‡‘å¸"></div>`;
            }).join('');
            labelsContainer.innerHTML = data.map(d => `<span>${d.date.substring(5)}</span>`).join('');
        } else {
            barsContainer.innerHTML = '<div class="empty-placeholder">æš‚æ— æ•°æ®</div>';
        }
    } catch (error) {
        barsContainer.innerHTML = '<div class="error-placeholder">åŠ è½½å¤±è´¥</div>';
    }
}

function formatNumber(num) {
    if (num >= 10000) {
        return (num / 10000).toFixed(1) + 'ä¸‡';
    }
    return num.toString();
}

function escapeHtml(text) {
    return String(text ?? '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

function renderHealthBadge(category, label) {
    const clsMap = {
        need_config: 'need',
        black: 'black',
        edge: 'edge',
        normal: 'normal',
    };
    const cls = clsMap[category] || 'normal';
    return `<span class="health-badge ${cls}">${escapeHtml(label || category)}</span>`;
}

function renderHealthPill(category, label, count) {
    const clsMap = {
        need_config: 'need',
        black: 'black',
        edge: 'edge',
        normal: 'normal',
    };
    const cls = clsMap[category] || 'normal';
    return `<div class="health-pill ${cls}">${escapeHtml(label)} <strong>${Number(count || 0)}</strong></div>`;
}

async function loadAccountHealth() {
    const meta = document.getElementById('accountHealthMeta');
    const title = document.getElementById('accountHealthTitle');
    const coinsTh = document.getElementById('accountHealthCoinsTh');
    const summary = document.getElementById('accountHealthSummary');
    const body = document.getElementById('accountHealthBody');
    const hint = document.getElementById('accountHealthHint');
    if (!meta || !summary || !body) return;

    body.innerHTML = '<tr><td colspan="5" class="loading-cell">åŠ è½½ä¸­...</td></tr>';

    try {
        const data = await apiRequest('/stats/account-health');
        const counts = data && data.counts ? data.counts : {};
        const statDate = data && data.stat_date ? String(data.stat_date) : '-';
        const basisLabel = data && data.basis_label ? String(data.basis_label) : 'ç»Ÿè®¡æ—¥';
        const total = Number(counts.total || 0);

        if (title) title.textContent = `è´¦å·çŠ¶æ€æé†’ï¼ˆ${basisLabel}ï¼‰`;
        if (coinsTh) coinsTh.textContent = `${basisLabel}é‡‘å¸`;
        if (hint) {
            hint.textContent = `åˆ¤å®šå£å¾„ï¼šéœ€æ›´æ¢é…ç½®=${basisLabel} 0ï¼›é»‘å·=0<${basisLabel}<500ï¼›è¾¹ç¼˜=500â‰¤${basisLabel}<10000ã€‚`;
        }

        meta.textContent = `ç»Ÿè®¡æ—¥æœŸï¼š${statDate}ï¼ˆ${basisLabel}ï¼‰ Â· è´¦å·æ€»æ•°ï¼š${total}`;
        summary.innerHTML = [
            renderHealthPill('need_config', 'éœ€æ›´æ¢é…ç½®', counts.need_config),
            renderHealthPill('black', 'é»‘å·', counts.black),
            renderHealthPill('edge', 'è¾¹ç¼˜', counts.edge),
            renderHealthPill('normal', 'æ­£å¸¸', counts.normal),
        ].join('');

        const items = Array.isArray(data && data.items) ? data.items : [];
        const issues = items.filter(i => i && i.category !== 'normal');

        if (issues.length === 0) {
            body.innerHTML = '<tr><td colspan="5" class="empty-cell">æš‚æ— éœ€è¦å¤„ç†çš„è´¦å·ï¼ˆæ˜¨æ—¥ï¼‰</td></tr>';
            return;
        }

        body.innerHTML = issues.map(i => {
            const remark = i.remark || i.env_name || ('è´¦å·#' + String(i.env_id || ''));
            const ownerName = i.owner_nickname || i.owner_username || (i.owner_user_id ? ('ç”¨æˆ·#' + String(i.owner_user_id)) : '-');
            const relationLabel = i.relation_label || '';
            const scopeText = `${relationLabel}${relationLabel ? ' Â· ' : ''}${ownerName}`;
            const coins = Number(i.stat_coins || 0);
            const coinsText = coins.toLocaleString('zh-CN');
            const statusHtml = renderHealthBadge(i.category, i.category_label);
            const configHref = i.owner_user_id ? `/config-envs?user_id=${encodeURIComponent(String(i.owner_user_id))}` : '/config-envs';
            return `
                <tr>
                    <td><span class="text-ellipsis" style="max-width:220px;display:inline-block;" title="${escapeHtml(remark)}">${escapeHtml(remark)}</span></td>
                    <td>${escapeHtml(scopeText)}</td>
                    <td class="coins-cell">${coinsText}</td>
                    <td>${statusHtml}</td>
                    <td><a class="link-action" href="${configHref}">å»é…ç½®</a></td>
                </tr>
            `;
        }).join('');
    } catch (error) {
        if (title) title.textContent = 'è´¦å·çŠ¶æ€æé†’';
        if (coinsTh) coinsTh.textContent = 'ç»Ÿè®¡é‡‘å¸';
        if (hint) {
            hint.textContent = 'åˆ¤å®šå£å¾„ï¼šéœ€æ›´æ¢é…ç½®=ç»Ÿè®¡æ—¥ 0ï¼›é»‘å·=0<ç»Ÿè®¡æ—¥<500ï¼›è¾¹ç¼˜=500â‰¤ç»Ÿè®¡æ—¥<10000ã€‚';
        }
        meta.textContent = 'åŠ è½½å¤±è´¥';
        body.innerHTML = `<tr><td colspan="5" class="error-cell">åŠ è½½å¤±è´¥ï¼š${escapeHtml(error && error.message ? error.message : 'æœªçŸ¥é”™è¯¯')}</td></tr>`;
    }
}

// æ˜¾ç¤ºæ–°æ‰‹æ­å»ºè¯´æ˜æ–‡æ¡£
async function showGuideDocument() {
    const modalOverlay = document.getElementById('modalOverlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalFooter = document.getElementById('modalFooter');

    // è®¾ç½®æ¨¡æ€æ¡†æ ‡é¢˜
    modalTitle.textContent = 'ğŸ“– æ–°æ‰‹æ­å»ºè¯´æ˜';

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    modalBody.innerHTML = '<div class="guide-modal-content"><div class="loading-text">ğŸ“„ æ­£åœ¨åŠ è½½æ–‡æ¡£å†…å®¹...</div></div>';

    // éšè—ç¡®è®¤æŒ‰é’®ï¼Œåªæ˜¾ç¤ºå…³é—­æŒ‰é’®
    modalFooter.innerHTML = '<button class="btn btn-primary" onclick="closeGlobalModal()">å…³é—­</button>';

    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    modalOverlay.style.display = 'flex';

    try {
        const response = await fetch('/api/guide/content');
        const data = await response.json();

        if (response.ok) {
            modalBody.innerHTML = `<div class="guide-modal-content">${data.content}</div>`;
        } else {
            modalBody.innerHTML = `<div class="guide-modal-content"><div class="loading-text">âŒ ${data.detail || 'åŠ è½½æ–‡æ¡£å¤±è´¥'}</div></div>`;
        }
    } catch (error) {
        modalBody.innerHTML = '<div class="guide-modal-content"><div class="loading-text">âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</div></div>';
    }
}
</script>
{% endblock %}
